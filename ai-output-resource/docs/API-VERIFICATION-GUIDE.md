# API éªŒè¯ä»»åŠ¡æ‰§è¡ŒæŒ‡å—

æœ¬æ–‡æ¡£æŒ‡å¯¼ä½ å®Œæˆ backend-dev-plan-1.2-verify-third-party-apis.md ä»»åŠ¡ã€‚

## âœ… å·²å®Œæˆçš„å‡†å¤‡å·¥ä½œ

1. âœ… å®‰è£…äº†å¿…è¦çš„ npm åŒ…ï¼ˆaxios, dotenv, @google/generative-aiï¼‰
2. âœ… åˆ›å»ºäº†æµ‹è¯•è„šæœ¬ï¼š
   - `test-qwen-video.js` - Qwen è§†é¢‘ç”Ÿæˆ API æµ‹è¯•
   - `test-gemini-llm.js` - Google Gemini LLM API æµ‹è¯•
3. âœ… æ›´æ–°äº† `.env.example` æ–‡ä»¶
4. âœ… åˆ›å»ºäº† `api-test-report.md` æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

## ğŸ“‹ æ¥ä¸‹æ¥éœ€è¦ä½ å®Œæˆçš„æ­¥éª¤

### æ­¥éª¤ 1: è·å– DashScope API Key (Qwen)

1. è®¿é—®é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°ï¼šhttps://bailian.console.aliyun.com/
2. ç™»å½•é˜¿é‡Œäº‘è´¦å·ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦å…ˆæ³¨å†Œï¼‰
3. ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„ "API-KEY"
4. ç‚¹å‡» "åˆ›å»ºæ–°çš„API-KEY"
5. å¤åˆ¶ç”Ÿæˆçš„ API Key

**æ³¨æ„äº‹é¡¹**:
- éœ€è¦å®Œæˆé˜¿é‡Œäº‘è´¦å·å®åè®¤è¯
- æ–°ç”¨æˆ·é€šå¸¸æœ‰å…è´¹è¯•ç”¨é¢åº¦
- API Key åªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·å¦¥å–„ä¿å­˜

### æ­¥éª¤ 2: è·å– Google Gemini API Key

1. è®¿é—® Google AI Studioï¼šhttps://aistudio.google.com/app/apikey
2. ç™»å½• Google è´¦å·
3. ç‚¹å‡» "Create API Key" æŒ‰é’®
4. é€‰æ‹©æˆ–åˆ›å»º Google Cloud é¡¹ç›®
5. å¤åˆ¶ç”Ÿæˆçš„ API Key

**æ³¨æ„äº‹é¡¹**:
- å…è´¹é…é¢ï¼š60 requests/minute
- éœ€è¦ Google è´¦å·
- API Key åˆ›å»ºåå¯ä»¥éšæ—¶æŸ¥çœ‹

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# æ–¹æ³• 1: å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
cp .env.example .env

# æ–¹æ³• 2: ç›´æ¥åˆ›å»º
cat > .env << 'EOF'
DASHSCOPE_API_KEY=ä½ çš„DashScope_API_Key
GOOGLE_API_KEY=ä½ çš„Google_API_Key
EOF
```

æˆ–è€…æ‰‹åŠ¨ç¼–è¾‘ï¼š
```bash
# æ‰“å¼€ç¼–è¾‘å™¨
nano .env

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ›¿æ¢ä¸ºä½ çš„å®é™… API Keyï¼‰
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxxxxxx
GOOGLE_API_KEY=AIzaSyxxxxxxxxxxxxxxxxxx
```

### æ­¥éª¤ 4: æµ‹è¯• Qwen è§†é¢‘ç”Ÿæˆ API

```bash
node test-qwen-video.js
```

**é¢„æœŸè¾“å‡º**:
```
ğŸš€ å¼€å§‹æµ‹è¯• Qwen è§†é¢‘ç”Ÿæˆ API...

ğŸ“¤ æäº¤è§†é¢‘ç”Ÿæˆä»»åŠ¡...
âœ… ä»»åŠ¡æäº¤æˆåŠŸ
ğŸ“‹ ä»»åŠ¡ ID: xxx-xxx-xxx
â³ ä»»åŠ¡çŠ¶æ€: PENDING

ğŸ” æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€...
âœ… çŠ¶æ€æŸ¥è¯¢æˆåŠŸ
ğŸ“Š ä»»åŠ¡çŠ¶æ€: RUNNING
ğŸ“ å®Œæ•´å“åº”: {...}

==================================================
âœ… Qwen API éªŒè¯æˆåŠŸï¼
==================================================
ğŸ“Œ ä»»åŠ¡ ID: xxx-xxx-xxx
ğŸ“Œ API ç«¯ç‚¹å¯ç”¨
ğŸ“Œ è®¤è¯æˆåŠŸ
ğŸ“Œ å»ºè®®: ä¿å­˜ä»»åŠ¡ ID ä»¥ä¾¿åç»­æŸ¥è¯¢ç»“æœ
```

**å¸¸è§é—®é¢˜å¤„ç†**:
- å¦‚æœé‡åˆ° 401 é”™è¯¯ï¼šæ£€æŸ¥ DASHSCOPE_API_KEY æ˜¯å¦æ­£ç¡®
- å¦‚æœé‡åˆ° 429 é”™è¯¯ï¼šè¯·æ±‚é¢‘ç‡è¶…é™ï¼Œç¨åå†è¯•
- å¦‚æœé‡åˆ° 400 é”™è¯¯ï¼šè¯·æ±‚å‚æ•°æœ‰è¯¯ï¼Œæ£€æŸ¥è¾“å…¥æ ¼å¼

### æ­¥éª¤ 5: æµ‹è¯• Google Gemini API

```bash
node test-gemini-llm.js
```

**é¢„æœŸè¾“å‡º**:
```
ğŸš€ å¼€å§‹æµ‹è¯• Google Gemini API...

ğŸ“ æµ‹è¯•ç”¨ä¾‹ 1: åŸºç¡€æ–‡æœ¬ç”Ÿæˆ
âœ… å“åº”æˆåŠŸ
ğŸ“„ å“åº”å†…å®¹: [Gemini çš„è‡ªæˆ‘ä»‹ç»]

ğŸ“ æµ‹è¯•ç”¨ä¾‹ 2: è§†é¢‘åˆ¶ä½œ AI åŠ©æ‰‹
âœ… å“åº”æˆåŠŸ
ğŸ“„ AI å»ºè®®: [JSON æ ¼å¼çš„å»ºè®®]

ğŸ“ æµ‹è¯•ç”¨ä¾‹ 3: è¿é•œå‚æ•°ä¼˜åŒ–
âœ… å“åº”æˆåŠŸ
ğŸ“„ ä¼˜åŒ–å»ºè®®: [å‚æ•°ä¼˜åŒ–å»ºè®®]

==================================================
âœ… Google Gemini API éªŒè¯æˆåŠŸï¼
==================================================
ğŸ“Œ æ¨¡å‹: gemini-pro
ğŸ“Œ API å¯ç”¨
ğŸ“Œ è®¤è¯æˆåŠŸ
ğŸ“Œ å“åº”é€Ÿåº¦è‰¯å¥½
ğŸ“Œ é€‚åˆç”¨äº AI åä½œåŠ©æ‰‹åŠŸèƒ½
```

**å¸¸è§é—®é¢˜å¤„ç†**:
- API_KEY_INVALIDï¼šæ£€æŸ¥ GOOGLE_API_KEY æ˜¯å¦æ­£ç¡®
- RESOURCE_EXHAUSTEDï¼šé…é¢å·²ç”¨å°½ï¼Œç¨åå†è¯•æˆ–å‡çº§
- PERMISSION_DENIEDï¼šæƒé™ä¸è¶³ï¼Œæ£€æŸ¥ API Key æƒé™è®¾ç½®

### æ­¥éª¤ 6: å¡«å†™æµ‹è¯•æŠ¥å‘Š

ç¼–è¾‘ `api-test-report.md` æ–‡ä»¶ï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹ï¼š

1. **æµ‹è¯•æ—¶é—´**: å¡«å†™å½“å‰æ—¥æœŸ
2. **ä»»åŠ¡ ID**: å¡«å†™ Qwen æµ‹è¯•ä¸­è·å¾—çš„ä»»åŠ¡ ID
3. **å‹¾é€‰æµ‹è¯•ç»“æœ**: å°† `[ ]` æ”¹ä¸º `[x]`
4. **å“åº”ç¤ºä¾‹**: ç²˜è´´å®é™…æµ‹è¯•çš„å“åº”æ•°æ®
5. **æµ‹è¯•é—®é¢˜**: è®°å½•é‡åˆ°çš„ä»»ä½•é—®é¢˜
6. **æ€§èƒ½æ•°æ®**: å¡«å†™å“åº”æ—¶é—´ç­‰æ€§èƒ½æŒ‡æ ‡
7. **æˆæœ¬åˆ†æ**: æ ¹æ®å®˜æ–¹æ–‡æ¡£è¡¥å……è®¡è´¹ä¿¡æ¯

### æ­¥éª¤ 7: éªŒè¯ä»»åŠ¡å®Œæˆ

ç¡®è®¤ä»¥ä¸‹æ‰€æœ‰é¡¹éƒ½å·²å®Œæˆï¼š

- [ ] DashScope API Key å·²è·å–
- [ ] Qwen è§†é¢‘ç”Ÿæˆ API è°ƒç”¨æˆåŠŸï¼ˆä»»åŠ¡æäº¤å’ŒçŠ¶æ€æŸ¥è¯¢ï¼‰
- [ ] Google API Key å·²è·å–
- [ ] Gemini LLM API è°ƒç”¨æˆåŠŸï¼ˆè‡³å°‘ 3 ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- [ ] è®°å½•äº†ä¸¤ä¸ª API çš„è°ƒç”¨æ ¼å¼ã€å‚æ•°å’Œå“åº”æ ¼å¼
- [ ] è®°å½•äº† API è°ƒç”¨æˆæœ¬å’Œé™é¢ä¿¡æ¯
- [ ] æµ‹è¯•è„šæœ¬å¯æ­£å¸¸è¿è¡Œ
- [ ] `api-test-report.md` å·²å¡«å†™å®Œæ•´

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œå¯ä»¥æ·»åŠ  `--trace-warnings` æŸ¥çœ‹è¯¦ç»†å †æ ˆï¼š
```bash
node --trace-warnings test-qwen-video.js
```

### æµ‹è¯•ç½‘ç»œè¿æ¥

```bash
# æµ‹è¯•èƒ½å¦è®¿é—® DashScope
curl -I https://dashscope.aliyuncs.com

# æµ‹è¯•èƒ½å¦è®¿é—® Google AI
curl -I https://generativelanguage.googleapis.com
```

### éªŒè¯ç¯å¢ƒå˜é‡åŠ è½½

åˆ›å»ºä¸´æ—¶æµ‹è¯•æ–‡ä»¶ï¼š
```bash
cat > test-env.js << 'EOF'
import dotenv from 'dotenv';
dotenv.config();

console.log('DASHSCOPE_API_KEY:', process.env.DASHSCOPE_API_KEY ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®');
console.log('GOOGLE_API_KEY:', process.env.GOOGLE_API_KEY ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®');
EOF

node test-env.js
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **Qwen API æ–‡æ¡£**: https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=2867393
- **Qwen è§†é¢‘ç”Ÿæˆ**: https://help.aliyun.com/zh/dashscope/developer-reference/video-generation
- **Google Gemini æ–‡æ¡£**: https://ai.google.dev/docs
- **Gemini Node.js SDK**: https://github.com/google/generative-ai-js

## ğŸ’¡ æç¤º

1. **API Key å®‰å…¨**:
   - ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key
   - å®šæœŸè½®æ¢ API Key

2. **æˆæœ¬æ§åˆ¶**:
   - å…ˆä½¿ç”¨å…è´¹é¢åº¦è¿›è¡Œæµ‹è¯•
   - ç›‘æ§ API è°ƒç”¨æ¬¡æ•°
   - è®¾ç½®æˆæœ¬é¢„è­¦

3. **é”™è¯¯å¤„ç†**:
   - æ‰€æœ‰æµ‹è¯•è„šæœ¬å·²åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†
   - è®°å½•æ‰€æœ‰é”™è¯¯ä¿¡æ¯ä»¥ä¾¿æ’æŸ¥

4. **åç»­ä»»åŠ¡**:
   - å®Œæˆæ­¤ä»»åŠ¡åï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ `backend-dev-plan-2.1-project-init.md`
   - æµ‹è¯•æŠ¥å‘Šå°†ç”¨äºåç»­çš„é›†æˆæµ‹è¯•å‚è€ƒ

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒå¸¸è§é—®é¢˜æˆ–æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚**
