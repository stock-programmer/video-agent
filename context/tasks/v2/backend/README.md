# v2.0 DAG ä»»åŠ¡ç´¢å¼•

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ˜¯ v2.0 "ä¸€é”®ä¼˜åŒ–æç¤ºè¯" åŠŸèƒ½çš„å®Œæ•´ä»»åŠ¡åˆ—è¡¨,é‡‡ç”¨ DAG (Directed Acyclic Graph) æ¨¡å‹ç»„ç»‡ã€‚

**æ€»ä»»åŠ¡æ•°**: 17 ä¸ª (åç«¯ 11 ä¸ª + å‰ç«¯ 6 ä¸ª)
**é¢„è®¡æ€»å·¥æ—¶**: 60-70 å°æ—¶ (3-4 å‘¨)

---

## ä»»åŠ¡æ‰§è¡ŒåŸåˆ™

1. **å±‚çº§æ‰§è¡Œ**: å¿…é¡»å®Œæˆå½“å‰å±‚çš„æ‰€æœ‰ä»»åŠ¡åæ‰èƒ½è¿›å…¥ä¸‹ä¸€å±‚
2. **å¹¶è¡Œæ‰§è¡Œ**: åŒä¸€å±‚å†…çš„ä»»åŠ¡å¯ä»¥å¹¶è¡Œå¼€å‘
3. **ä¾èµ–æ£€æŸ¥**: å¼€å§‹ä»»åŠ¡å‰æ£€æŸ¥ä¾èµ–ä»»åŠ¡æ˜¯å¦å®Œæˆ
4. **æµ‹è¯•é©±åŠ¨**: æ¯ä¸ªä»»åŠ¡å®Œæˆåå¿…é¡»é€šè¿‡éªŒæ”¶æ ‡å‡†
5. **æ—¥å¿—ä¼˜å…ˆ**: æ‰€æœ‰å¤–éƒ¨è°ƒç”¨å¿…é¡»å®Œæ•´è®°å½•è¯·æ±‚/å“åº”æ—¥å¿—

---

## åç«¯ä»»åŠ¡ (Backend Tasks)

### Layer 1: åŸºç¡€å·¥å…·æ¨¡å— (å¯å¹¶è¡Œ)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **B-L1-T1** | å®ç° Qwen VL è§†é¢‘åˆ†ææœåŠ¡ | 3h | æ—  | [layer1-task1-qwen-vl-service.md](./backend/layer1-task1-qwen-vl-service.md) |
| **B-L1-T2** | å®ç° Agent è¾…åŠ©å·¥å…· | 2h | æ—  | [layer1-task2-agent-helpers.md](./backend/layer1-task2-agent-helpers.md) |
| **B-L1-T3** | å®ç° QwenWithTools Wrapper | 2h | æ—  | [layer1-task3-qwen-wrapper.md](./backend/layer1-task3-qwen-wrapper.md) |

**Layer 1 å®Œæˆæ ‡å‡†**: æ‰€æœ‰ 3 ä¸ªå·¥å…·æ¨¡å—æµ‹è¯•é€šè¿‡,æ—¥å¿—å®Œæ•´

---

### Layer 2: Agent æ ¸å¿ƒæ¨¡å— (ä¾èµ– Layer 1)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **B-L2-T1** | å®ç° Intent Analysis Sub-Agent | 4h | B-L1-T2, B-L1-T3 | [layer2-task1-intent-agent.md](./backend/layer2-task1-intent-agent.md) |
| **B-L2-T2** | å®ç° Video Analysis Sub-Agent | 4h | B-L1-T1, B-L1-T2, B-L1-T3 | [layer2-task2-video-agent.md](./backend/layer2-task2-video-agent.md) |
| **B-L2-T3** | å®ç° Master Agent | 6h | B-L2-T1, B-L2-T2 | [layer2-task3-master-agent.md](./backend/layer2-task3-master-agent.md) |

**Layer 2 å®Œæˆæ ‡å‡†**: Agent ç³»ç»Ÿå¯ç‹¬ç«‹è¿è¡Œ,èƒ½å®Œæˆå®Œæ•´æ¨ç†æµç¨‹

---

### Layer 3: Agent ç³»ç»Ÿä¸»å…¥å£ (ä¾èµ– Layer 2)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **B-L3-T1** | å®ç° Prompt Optimizer ä¸»æµç¨‹ | 6h | B-L2-T3 | [layer3-task1-prompt-optimizer.md](./backend/layer3-task1-prompt-optimizer.md) |

**å…³é”®åŠŸèƒ½**:
- åˆ†é˜¶æ®µæ‰§è¡Œ Agent (Intent â†’ Human-in-the-Loop â†’ Video â†’ Master)
- WebSocket è¿›åº¦æ¨é€
- æ•°æ®åº“ç»“æœä¿å­˜

---

### Layer 4: API å’Œ WebSocket (ä¾èµ– Layer 3)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **B-L4-T1** | å®ç° Optimize Prompt API | 2h | B-L3-T1 | [layer4-task1-optimize-api.md](./backend/layer4-task1-optimize-api.md) |
| **B-L4-T2** | å®ç° WebSocket ä¼˜åŒ–åè®® | 3h | B-L3-T1 | [layer4-task2-websocket-handler.md](./backend/layer4-task2-websocket-handler.md) |
| **B-L4-T3** | é›†æˆåˆ°ä¸»æœåŠ¡å™¨ | 1h | B-L4-T1, B-L4-T2 | [layer4-task3-server-integration.md](./backend/layer4-task3-server-integration.md) |

**Layer 4 å®Œæˆæ ‡å‡†**: API å¯é€šè¿‡ HTTP è°ƒç”¨,WebSocket æ¶ˆæ¯æ­£å¸¸æ”¶å‘

---

### Layer 5: é”™è¯¯å¤„ç†ä¸æ—¥å¿— (ä¾èµ– Layer 4)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **B-L5-T1** | å®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿— | 3h | B-L4-T3 | [layer5-task1-error-handling.md](./backend/layer5-task1-error-handling.md) |
| **B-L5-T2** | æ•°æ®åº“ Schema æ›´æ–° | 2h | æ—  | [layer5-task2-database-schema.md](./backend/layer5-task2-database-schema.md) |

**Layer 5 å®Œæˆæ ‡å‡†**: æ‰€æœ‰å¼‚å¸¸åœºæ™¯éƒ½æœ‰æ—¥å¿—,æ•°æ®åº“å­—æ®µå·²æ‰©å±•

---

## å‰ç«¯ä»»åŠ¡ (Frontend Tasks)

### Layer 1: çŠ¶æ€ç®¡ç† (å¯å¹¶è¡Œ)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **F-L1-T1** | æ‰©å±• Zustand Store | 3h | æ—  | [layer1-task1-zustand-store.md](./frontend/layer1-task1-zustand-store.md) |
| **F-L1-T2** | æ‰©å±• WebSocket Client | 2h | æ—  | [layer1-task2-websocket-client.md](./frontend/layer1-task2-websocket-client.md) |

**Layer 1 å®Œæˆæ ‡å‡†**: Store æ”¯æŒä¼˜åŒ–çŠ¶æ€ç®¡ç†,WebSocket èƒ½å¤„ç† v2 æ¶ˆæ¯

---

### Layer 2: åŸºç¡€ç»„ä»¶ (ä¾èµ– Layer 1)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **F-L2-T1** | å®ç° OptimizeButton ç»„ä»¶ | 2h | F-L1-T1 | [layer2-task1-optimize-button.md](./frontend/layer2-task1-optimize-button.md) |
| **F-L2-T2** | å®ç° AgentProgress ç»„ä»¶ | 2h | æ—  | [layer2-task2-agent-progress.md](./frontend/layer2-task2-agent-progress.md) |

---

### Layer 3: æ ¸å¿ƒç»„ä»¶ (ä¾èµ– Layer 1, Layer 2)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **F-L3-T1** | å®ç° AIOutputArea ç»„ä»¶ | 4h | F-L1-T1, F-L1-T2, F-L2-T2 | [layer3-task1-ai-output-area.md](./frontend/layer3-task1-ai-output-area.md) |
| **F-L3-T2** | å®ç° IntentReportModal ç»„ä»¶ | 4h | F-L1-T1, F-L1-T2 | [layer3-task2-intent-modal.md](./frontend/layer3-task2-intent-modal.md) |
| **F-L3-T3** | å®ç° OptimizationResult ç»„ä»¶ | 3h | F-L1-T1 | [layer3-task3-optimization-result.md](./frontend/layer3-task3-optimization-result.md) |

**Layer 3 å®Œæˆæ ‡å‡†**: æ‰€æœ‰ UI ç»„ä»¶å¯ç‹¬ç«‹æ¸²æŸ“å’Œæµ‹è¯•

---

### Layer 4: é›†æˆä¸æ ·å¼ (ä¾èµ– Layer 3)

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥æ—¶ | ä¾èµ– | æ–‡æ¡£ |
|---------|---------|------|------|------|
| **F-L4-T1** | é›†æˆåˆ° Workspace ç»„ä»¶ | 2h | F-L3-T1, F-L3-T2, F-L3-T3 | [layer4-task1-workspace-integration.md](./frontend/layer4-task1-workspace-integration.md) |
| **F-L4-T2** | æ ·å¼ä¼˜åŒ–å’ŒåŠ¨ç”» | 2h | F-L4-T1 | [layer4-task2-styling.md](./frontend/layer4-task2-styling.md) |

**Layer 4 å®Œæˆæ ‡å‡†**: v2 åŠŸèƒ½å®Œå…¨é›†æˆåˆ° v1.x UI,å‘åå…¼å®¹

---

## ä»»åŠ¡ä¾èµ–å›¾

```
åç«¯ (Backend)                        å‰ç«¯ (Frontend)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Layer 1 (å¯å¹¶è¡Œ)                      Layer 1 (å¯å¹¶è¡Œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L1-T1     â”‚                       â”‚ F-L1-T1     â”‚
â”‚ Qwen VL     â”‚                       â”‚ Zustand     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L1-T2     â”‚                       â”‚ F-L1-T2     â”‚
â”‚ Helpers     â”‚                       â”‚ WebSocket   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L1-T3     â”‚
â”‚ QwenTools   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                                     â†“
Layer 2                               Layer 2
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L2-T1     â”‚                       â”‚ F-L2-T1     â”‚
â”‚ Intent Agt  â”‚                       â”‚ Button      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L2-T2     â”‚                       â”‚ F-L2-T2     â”‚
â”‚ Video Agt   â”‚                       â”‚ Progress    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L2-T3     â”‚
â”‚ Master Agt  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                                     â†“
Layer 3                               Layer 3
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L3-T1     â”‚                       â”‚ F-L3-T1     â”‚
â”‚ Optimizer   â”‚                       â”‚ OutputArea  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚ F-L3-T2     â”‚
Layer 4                                â”‚ Modal       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ B-L4-T1     â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API         â”‚                       â”‚ F-L3-T3     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚ Result      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ B-L4-T2     â”‚                              â†“
â”‚ WebSocket   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       Layer 4
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L4-T3     â”‚                       â”‚ F-L4-T1     â”‚
â”‚ Integration â”‚                       â”‚ Integration â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚ F-L4-T2     â”‚
Layer 5                                â”‚ Styling     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ B-L5-T1     â”‚
â”‚ Error/Log   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ B-L5-T2     â”‚
â”‚ DB Schema   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å‰åç«¯å¯å®Œå…¨å¹¶è¡Œå¼€å‘
```

---

## å¼€å‘å»ºè®®

### æ¨èå¼€å‘é¡ºåº

**Week 1**:
- åç«¯: Layer 1 + Layer 2 (B-L1-T1 ~ B-L2-T3)
- å‰ç«¯: Layer 1 (F-L1-T1 ~ F-L1-T2)

**Week 2**:
- åç«¯: Layer 3 + Layer 4 (B-L3-T1 ~ B-L4-T3)
- å‰ç«¯: Layer 2 + Layer 3 (F-L2-T1 ~ F-L3-T3)

**Week 3**:
- åç«¯: Layer 5 (B-L5-T1 ~ B-L5-T2)
- å‰ç«¯: Layer 4 (F-L4-T1 ~ F-L4-T2)
- é›†æˆæµ‹è¯•

**Week 4**:
- Bug ä¿®å¤
- æ€§èƒ½ä¼˜åŒ–
- éƒ¨ç½²ä¸Šçº¿

### å¹¶è¡Œå¼€å‘ç­–ç•¥

**å•äººå¼€å‘**: å»ºè®®å…ˆå®Œæˆåç«¯ Layer 1-3,å†å¼€å‘å‰ç«¯
**åŒäººå›¢é˜Ÿ**: åç«¯å’Œå‰ç«¯å®Œå…¨å¹¶è¡Œ
**ä¸‰äººå›¢é˜Ÿ**: åç«¯ (2äºº) + å‰ç«¯ (1äºº)

---

## ä»»åŠ¡æ–‡æ¡£æ¨¡æ¿

æ¯ä¸ªä»»åŠ¡æ–‡æ¡£åŒ…å«:
- âœ… ä»»åŠ¡å…ƒæ•°æ® (ID, ä¾èµ–, å·¥æ—¶)
- âœ… ä»»åŠ¡ç›®æ ‡
- âœ… è¾“å…¥/è¾“å‡º
- âœ… è¯¦ç»†å®ç°æ­¥éª¤
- âœ… ä»£ç ç¤ºä¾‹
- âœ… éªŒæ”¶æ ‡å‡†
- âœ… æµ‹è¯•è¦æ±‚
- âœ… å‚è€ƒæ–‡æ¡£é“¾æ¥

---

## å…³é”®é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | å®Œæˆæ ‡å‡† | é¢„è®¡æ—¶é—´ |
|--------|---------|---------|
| **M1: åç«¯æ ¸å¿ƒå®Œæˆ** | Layer 1-3 æµ‹è¯•é€šè¿‡,Agent å¯ç‹¬ç«‹è¿è¡Œ | Week 2 |
| **M2: å‰ç«¯ UI å®Œæˆ** | Layer 1-3 ç»„ä»¶å¯æ¸²æŸ“,WebSocket è¿æ¥æ­£å¸¸ | Week 2 |
| **M3: API é›†æˆå®Œæˆ** | å‰åç«¯è”è°ƒæˆåŠŸ,å®Œæ•´æµç¨‹æ‰“é€š | Week 3 |
| **M4: ç”Ÿäº§å°±ç»ª** | æ‰€æœ‰æµ‹è¯•é€šè¿‡,æ–‡æ¡£å®Œæ•´ | Week 4 |

---

## å¿«é€Ÿå¼€å§‹

### åç«¯å¼€å‘è€…

1. é˜…è¯» `context/tasks/v2/v2-backend-architecture.md`
2. å¼€å§‹ Layer 1 ä»»åŠ¡: `backend/layer1-task1-qwen-vl-service.md`
3. æŒ‰å±‚çº§é¡ºåºå®Œæˆæ‰€æœ‰ä»»åŠ¡

### å‰ç«¯å¼€å‘è€…

1. é˜…è¯» `context/tasks/v2/v2-frontend-architecture.md`
2. å¼€å§‹ Layer 1 ä»»åŠ¡: `frontend/layer1-task1-zustand-store.md`
3. æŒ‰å±‚çº§é¡ºåºå®Œæˆæ‰€æœ‰ä»»åŠ¡

---

## å‚è€ƒæ–‡æ¡£

- **æ¶æ„æ€»è§ˆ**: `../v2-architecture-overview.md`
- **åç«¯æ¶æ„**: `../v2-backend-architecture.md`
- **å‰ç«¯æ¶æ„**: `../v2-frontend-architecture.md`
- **Agent è®¾è®¡**: `../v2-agent-system-design.md`
- **WebSocket åè®®**: `../v2-websocket-protocol.md`
- **å¼€å‘è®¡åˆ’**: `../v2-development-plan.md`

---

## æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: æ‰€æœ‰ v2 ä»£ç ä¸å¾—ç ´å v1.x åŠŸèƒ½
2. **æ—¥å¿—ä¼˜å…ˆ**: å¿…é¡»è®°å½•å®Œæ•´çš„è¯·æ±‚/å“åº”æ—¥å¿— (è§ CLAUDE.md)
3. **æµ‹è¯•é©±åŠ¨**: æ¯ä¸ªä»»åŠ¡å®Œæˆåç«‹å³ç¼–å†™å’Œè¿è¡Œæµ‹è¯•
4. **ä¾èµ–æ£€æŸ¥**: å¼€å§‹æ–°ä»»åŠ¡å‰ç¡®è®¤ä¾èµ–ä»»åŠ¡å·²å®Œæˆ
5. **ä»£ç å®¡æŸ¥**: å…³é”®æ¨¡å— (Agent ç³»ç»Ÿ) éœ€è¦ peer review

---

**ç¥å¼€å‘é¡ºåˆ©! ğŸš€**
