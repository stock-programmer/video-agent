# v1.1 任务 1.1 - 验证Qwen API参数支持

## 层级
第1层 - 无依赖，可立即开始

## 并行任务
无（此任务必须先完成，因为后续任务依赖其结果）

## 任务目标
验证Qwen video API是否支持v1.1新增的4个参数：
- duration (视频时长)
- aspect_ratio (宽高比)
- motion_intensity (运动强度)
- quality/resolution (质量预设)

## 执行步骤

### 1. 阅读Qwen API文档
```bash
# 查看本地API文档
cat context/third-part/qwen-pic-to-video-first-pic.txt
```

**关注点**：
- 查找支持的参数列表
- 确认参数名称和值范围
- 查看示例代码

### 2. 创建API测试脚本
```bash
# 创建测试脚本
mkdir -p ai-output-resource/test-scripts/v1.1
touch ai-output-resource/test-scripts/v1.1/test-qwen-new-params.js
```

**测试脚本内容** (`test-qwen-new-params.js`):
```javascript
const axios = require('axios');
require('dotenv').config();

const DASHSCOPE_API_KEY = process.env.DASHSCOPE_API_KEY;
const API_BASE = 'https://dashscope.aliyuncs.com/api/v1';

async function testParameter(paramName, paramValue, imageUrl) {
  console.log(`\n[测试] ${paramName} = ${paramValue}`);

  try {
    const response = await axios.post(
      `${API_BASE}/services/aigc/video-generation/generation`,
      {
        model: 'wan2.6-i2v',
        input: {
          image_url: imageUrl,
          [paramName]: paramValue  // 动态参数
        }
      },
      {
        headers: {
          'Authorization': `Bearer ${DASHSCOPE_API_KEY}`,
          'Content-Type': 'application/json'
        }
      }
    );

    console.log(`✅ ${paramName} 支持！Response:`, response.data);
    return { supported: true, response: response.data };
  } catch (error) {
    console.log(`❌ ${paramName} 不支持或出错:`, error.response?.data || error.message);
    return { supported: false, error: error.response?.data };
  }
}

async function main() {
  const testImageUrl = 'YOUR_TEST_IMAGE_URL'; // 替换为测试图片URL

  console.log('=== Qwen API v1.1 参数验证 ===\n');

  // 测试1: duration
  await testParameter('duration', 4, testImageUrl);
  await testParameter('duration', 8, testImageUrl);

  // 测试2: aspect_ratio
  await testParameter('aspect_ratio', '16:9', testImageUrl);
  await testParameter('aspect_ratio', '9:16', testImageUrl);

  // 测试3: motion_intensity / strength
  await testParameter('motion_intensity', 3, testImageUrl);
  await testParameter('strength', 0.5, testImageUrl);

  // 测试4: resolution / quality
  await testParameter('resolution', '720p', testImageUrl);
  await testParameter('resolution', '1080p', testImageUrl);
  await testParameter('quality', 'standard', testImageUrl);

  console.log('\n=== 测试完成 ===');
}

main().catch(console.error);
```

### 3. 运行测试
```bash
cd backend
node ../ai-output-resource/test-scripts/v1.1/test-qwen-new-params.js
```

### 4. 记录测试结果
创建测试报告：`ai-output-resource/docs/v1.1-api-verification-report.md`

**报告模板**：
```markdown
# v1.1 Qwen API 参数验证报告

## 测试日期
2025-01-XX

## 测试环境
- Model: wan2.6-i2v
- API Version: v1

## 参数验证结果

### 1. Duration (视频时长)
- **测试参数名**: `duration`
- **测试值**: 2, 4, 6, 8 (秒)
- **API支持**: [ ] 是 / [ ] 否
- **实际参数名**: ___________
- **支持的值范围**: ___________
- **备注**: ___________

### 2. Aspect Ratio (宽高比)
- **测试参数名**: `aspect_ratio`
- **测试值**: "16:9", "9:16", "1:1", "4:3"
- **API支持**: [ ] 是 / [ ] 否
- **实际参数名**: ___________
- **支持的值范围**: ___________
- **备注**: ___________

### 3. Motion Intensity (运动强度)
- **测试参数名**: `motion_intensity`, `strength`
- **测试值**: 1-5 或 0.0-1.0
- **API支持**: [ ] 是 / [ ] 否
- **实际参数名**: ___________
- **支持的值范围**: ___________
- **备注**: ___________

### 4. Quality / Resolution (质量)
- **测试参数名**: `quality`, `resolution`
- **测试值**: "720p", "1080p", "standard", "high"
- **API支持**: [ ] 是 / [ ] 否
- **实际参数名**: ___________
- **支持的值范围**: ___________
- **备注**: ___________

## 参数映射表

| v1.1 UI参数 | Qwen API参数 | 值映射 | 备注 |
|------------|--------------|--------|------|
| duration: 2 | ? | ? | |
| duration: 4 | ? | ? | |
| duration: 6 | ? | ? | |
| duration: 8 | ? | ? | |
| aspect_ratio: '16:9' | ? | ? | |
| aspect_ratio: '9:16' | ? | ? | |
| aspect_ratio: '1:1' | ? | ? | |
| motion_intensity: 1 | ? | ? | |
| motion_intensity: 3 | ? | ? | |
| motion_intensity: 5 | ? | ? | |
| quality_preset: 'draft' | ? | ? | |
| quality_preset: 'standard' | ? | ? | |
| quality_preset: 'high' | ? | ? | |

## 不支持参数的Workaround方案

### 如果Duration不支持
- 方案：使用API默认值，在文档中说明限制
- 优先级：低（可接受）

### 如果Aspect Ratio不支持
- 方案1：前端裁剪图片后上传
- 方案2：后端使用图像处理库裁剪
- 优先级：高（必须实现）

### 如果Motion Intensity不支持
- 方案：在motion_prompt中添加强度关键词
  - Low: "slowly", "gently", "subtle"
  - Medium: "naturally", "moderate"
  - High: "quickly", "energetically", "dynamic"
- 优先级：中（可接受降级）

### 如果Quality不支持
- 方案：使用resolution参数替代
  - draft → 720p
  - standard → 1080p
  - high → 1080p (maximal settings)
- 优先级：中

## 结论

[ ] 所有参数均支持 - 可直接实现
[ ] 部分参数支持 - 需实现workaround
[ ] 大部分参数不支持 - 需重新评估v1.1范围

## 建议

(填写基于测试结果的实现建议)
```

### 5. 更新实现策略
基于测试结果，更新后续任务的实现方案。

## 验收标准

- [ ] Qwen API文档已完整阅读
- [ ] 测试脚本已创建并成功运行
- [ ] 所有4个参数已测试（duration, aspect_ratio, motion_intensity, quality）
- [ ] 测试报告已创建并完整填写
- [ ] 参数映射表已完成
- [ ] 不支持参数的workaround方案已确定
- [ ] 测试结果已提交到 `ai-output-resource/docs/`

## 输出物

1. 测试脚本：`ai-output-resource/test-scripts/v1.1/test-qwen-new-params.js`
2. 测试报告：`ai-output-resource/docs/v1.1-api-verification-report.md`
3. 参数映射表（在报告中）
4. Workaround方案文档（在报告中）

## 下一步

**如果所有参数支持**：
- 继续 v1.1-2.1-update-database-schema.md (数据库更新)
- 继续 v1.1-3.1-update-type-definitions.md (类型定义)

**如果部分参数不支持**：
- 先确定workaround方案
- 更新后续任务的实现细节
- 然后继续Layer 2-3任务

## 预计耗时
4 小时

## 依赖任务
无
